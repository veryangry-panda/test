<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Document</title>
	</head>
	<style>
		.img{
			width: 200px;
			height: 100px;
			background-repeat: no-repeat ;
		}
	</style>
	<body onload="fn()">
		<input type="text" placeholder="请输入你需要查询的学年" id="schoolYear"/><br />
		<input type="text" placeholder="请输入你需要查询的学期" id="term"/><br />
		<input type="text" placeholder="请输入验证码"/ id="checkcode"><br />
		<div class="img" id="placeimg" style="background-image: url(value/images/test_images/placeholder.png);"></div>
		<input type="submit" value="查询成绩" id="submit"/>
	</body>
</html>
<script>
	function fn(){
		var timer=setInterval(function(){
			var ajax=new XMLHttpRequest();
			ajax.open("get","php/CaptureGrade/CaptureCheckcode.php");
			ajax.send();
			ajax.onreadystatechange=function(){
				if(ajax.readyState==4&&ajax.status==200){
					
					try{
						var jsObj=JSON.parse(ajax.responseText);
						if(!JSON.parse(ajax.responseText)){
							throw 'error';
						}
						console.log(jsObj.result)
						if(jsObj.result=="success"){
							//设置验证码图片
							document.querySelector("#placeimg").style.backgroundImage="url(value/images/CaptureGrade/checkcode.jpg)"
							clearInterval(timer);
						}
					}catch(er){
						if(er=='error'){
							document.body.innerHTML="系统异常，请稍后再试"
						}
					}
					
				}
			}
		},1000)
		
	}
	document.querySelector("#submit").onclick=function(){
		var checkcode=document.querySelector("#checkcode").value;
		var schoolYear=document.querySelector("#schoolYear").value;
		var term=document.querySelector("#term").value;
		var str='';
		str+=checkcode;
		str+='&';
		str+=schoolYear;
		str+='&';
		str+=term;
		if(checkcode!=''&&schoolYear!=''&&term!=''){
			window.location.href="grade.html?"+str;
		}
		
	}
</script>