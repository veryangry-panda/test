<!--成绩查询界面-->
<!--成绩查询界面-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>grade</title>
    <link rel="stylesheet" href="css/grade.css">
    <script src="js/cookie.js"></script>
    <script src="js/background_cover.js"></script>
</head>
<body onload="fn()">
    <!--显示总绩点的圆形盒子-->
<div class="top round">
        <!--绩点-->
        <p>
            <!--测试视觉效果用-->
            5.01
        </p>
</div>
<!--显示具体成绩的方型盒子-->
<div class="footer">
    <!--用一个固定流的表头覆盖住原先的表头，产生表头固定的效果-->
    <div>
        <table class="fixed_table">
            <thead>
                <tr>
                    <th class="course">课程</th>
                    <th>学分</th>
                    <th>绩点</th>
                    <th>成绩</th>
                </tr>
            </thead>
        </table>
    </div>
    <!--用表格标签来记录数据-->
    <table>
        <thead class="real_thead">
            <tr>
                <th class="course">课程</th>
                <th>学分</th>
                <th>绩点</th>
                <th>成绩</th>
            </tr>
        </thead>

        <tbody id="tbody">
            <!--<tr></tr>
            <!--数据的样式，js处理数据的时候参照此格式-->
            <!--<tr>-->
                <!--<td>计算机应用</td>-->
                <!--<td>1.0</td>-->
                <!--<td>1.0</td>-->
                <!--<td>不合格</td>-->
            <!--</tr>
            <tr>
                <td>计算机应用</td>
                <td>1.0</td>
                <td>1.0</td>
                <td>不合格</td>
            </tr>-->



        </tbody>

    </table>
</div>
</body>
</html>
<script>
	
	
	function fn(){
		var str=window.location.search;
//		console.log(str)
		var arr=str.split('&');
		var checkcode=arr[0].slice(1);
//		console.log(checkcode)
		var schoolYear=arr[1];
//		console.log(schoolYear)
		var term=arr[2];
//		console.log(term)
		var username=get_cookie_func("username");
//		console.log(username)
		var password=get_cookie_func("password");
//		console.log(password)
		var ajax=new XMLHttpRequest();
		ajax.open('post','php/CaptureGrade/CaptureScore.php');
		ajax.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		ajax.send('username='+username+'&password='+password+'&checkcode='+checkcode+'&schoolYear='+schoolYear+'&term='+term);
		ajax.onreadystatechange=function(){
			if(ajax.readyState==4&&ajax.status==200){
				var jsObj=JSON.parse(ajax.responseText);
//				console.log(jsObj)
//				console.log(jsObj.length);//underfined
//				console.log(jsObj.grade.length)
//				for(var i=0;i<jsObj.grade.length;i++){
//					console.log(jsObj.grade[i]);
//				}
//				console.log(jsObj.result)
//				
				if(jsObj.result=="success"){
					var strJson='';
					for(var i=0;i<jsObj.grade.length;i++){
						strJson+='<tr>'
						strJson+='<td>'+jsObj.grade[i].className+'</td>'
						strJson+='<td>'+jsObj.grade[i].credit+'</td>'
						strJson+='<td>'+jsObj.grade[i].GPA+'</td>'
						strJson+='<td>'+jsObj.grade[i].grade+'</td>'
						strJson+='</tr>'
					}
					var tbody=document.querySelector("#tbody")
					tbody.innerHTML=strJson;
				}else{
					document.body.innerHTML=jsObj.result;
					document.body.innerHTML=jsObj.failReason;
					window.location.href="bind.html"
					
				}
				
			}
		}
	}
</script>

